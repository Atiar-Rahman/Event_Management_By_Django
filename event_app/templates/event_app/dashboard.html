{% extends "event_app/base.html" %}
{% block content %}
<h1 class="text-2xl font-bold mb-4">Organizer Dashboard</h1>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
  <button class="stat-card p-4 bg-white rounded shadow" data-filter="all" id="stat-total-events">
    <div class="text-sm text-gray-500">Total Events</div>
    <div class="text-2xl font-bold">{{ total_events }}</div>
  </button>
  <button class="stat-card p-4 bg-white rounded shadow" data-filter="upcoming" id="stat-upcoming">
    <div class="text-sm text-gray-500">Upcoming Events</div>
    <div class="text-2xl font-bold">{{ upcoming_events }}</div>
  </button>
  <button class="stat-card p-4 bg-white rounded shadow" data-filter="past" id="stat-past">
    <div class="text-sm text-gray-500">Past Events</div>
    <div class="text-2xl font-bold">{{ past_events }}</div>
  </button>
  <div class="p-4 bg-white rounded shadow">
    <div class="text-sm text-gray-500">Total Participants</div>
    <div class="text-2xl font-bold">{{ total_participants }}</div>
  </div>
</div>

<div id="dynamic-area">
  <h2 class="text-xl font-semibold mb-2">Today's Events ({{ todays_events|length }})</h2>
  <div id="events-list" class="space-y-3">
    {% for e in todays_events %}
      <div class="bg-white p-3 rounded shadow">
        <div class="flex justify-between">
          <div>
            <div class="font-semibold">{{ e.name }}</div>
            <div class="text-sm text-gray-500">{{ e.category.name }} • {{ e.location }}</div>
          </div>
          <div class="text-sm">{{ e.num_participants }} participants</div>
        </div>
      </div>
    {% empty %}
      <p>No events for today.</p>
    {% endfor %}
  </div>
</div>

<script>
document.querySelectorAll('.stat-card').forEach(btn => {
  btn.addEventListener('click', function () {
    const filter = this.dataset.filter || 'all';
    fetch("{% url 'event_app:dashboard_stats_api' %}?filter=" + filter)
      .then(r=>r.json())
      .then(data => {
        const list = document.getElementById('events-list');
        list.innerHTML = '';
        data.events.forEach(e => {
          const html = `
            <div class="bg-white p-3 rounded shadow">
              <div class="flex justify-between">
                <div>
                  <div class="font-semibold">${e.name}</div>
                  <div class="text-sm text-gray-500">${e.category} • ${e.location}</div>
                </div>
                <div class="text-sm">${e.num_participants} participants</div>
              </div>
            </div>
          `;
          list.insertAdjacentHTML('beforeend', html);
        });
      });
  });
});
</script>
{% endblock %}
